																	***网际协议：因特网中的转发和编址***


​																	

![](..\img\IPv4.jpg)

IPv4数据报中的关键字段：

​	-***版本(号)***。这4个比特规定了数据报的IP协议版本。通过查看版本号，路由器能够确定如何解释IP数据报的剩余部分。

​	-***首部长度***。因为一个IPv4数据报可包含一些可变数量的选项(这些选项包括在IPv4数据报首部中)，故需要用这4比特来确定IP数据报中数据部分实际从哪里开始。

​	-***服务类型***。服务类型(TOS)比特包含在IPv4首部中，以便使不同类型的IP数据报(例如，一些特别要求低时延、高吞吐量或可靠性的数据报)能相互区别开来。

​	-***数据报长度***。这是IP数据报的总长度(首部加上数据)，以字节计。因为该字段长为16比特，所以IP数据报的理论最大长度为65535字节，然而，数据报很少有超过1500字节的。

​	-***标识、标志、片偏移***。这三个字段与所谓的IP分片有关。

​	-***寿命***。寿命字段用来确保数据不会永远(如长时间的路由选择环路)在网络中循环。

​	-***协议***。该字段仅在一个IP数据报到达其最终目的地才会有用。该字段值指示了IP数据报的数据部分应交给哪个特定的运输层协议。

​	-***首部检验和***。首部检验和用于帮助路由器检测收到的IP数据报中的比特错误。

​	-***源和目的IP地址***。当某源生成一个数据报时，它在源IP字段中插入它的IP地址，在目的IP地址字段中插入其最终目的地的地址。

​	-***选项***。选项字段允许IP首部被扩展。首部选项意味着很少使用，因此决定对每个数据报首部不包括选项字段中的信息，这样能够节约开销。

​	-***数据(有效载荷)***，在大多数情况下，IP数据报中的数据字段包含要交付给目的地的运输层报文段。然而，该数据字段也可承载其他类型的数据，如ICMP报文。



MTU：一个链路层帧能承载的最大数据量叫做最大传送单元。



子网定义：为了确定子网，分开主机和路由器的每个接口。产生几个隔离的网络岛，使用接口端接这些隔离的网络的端点。这些隔离的网络中的每一个都叫做一个子网



因特网的地址分配策略被称为***无类别域间路由选择***(CIDR)。CIDR将子网寻址的概念一般化了。



动态主机配置协议(DHCP)。DHCP允许主机自动获取(被动分配)一个IP地址。DHCP具有能将主机连接进一个网络的网络相关方面的自动能力，故它又常被称为即插即用协议

***DHCP请求步骤***

​	***·DHCP服务器发现***。一台新到的主机的首要任务是发现一个要与其交互的DHCP服务器。

​	***·DHCP服务器提供***。DHCP服务器收到一个DHCP发现报文时，用一个DHCP提供报文向客户做出响应，仍然使用IP广播地址255.255.255.255.

​	***·DHCP请求***。新到达的客户从一个或多个服务器提供中选择一个，并向选中的服务器提供一个DHCP请求报文进行响应，回显配置参数。

​	***·DHCP ACK***。服务器用DHCP ACK报文对DHCP请求报文进行响应，证实所要求的参数。

网络地址转换(NAT)

NAT使能路由器对于外部世界来说甚至不像一台路由器。NAT路由器对外界的行为反过来就如同一个具有单一IP地址的单一设备。

UPnp穿越正越来越多地由通用即插即用(UPnp)提供，UPnP是一种允许主机发现并配置邻近NAT的协议。

![](..\img\ICMP.jpg)

IPv6数据报格式：

![](..\img\IPv6.jpg)

IPv6的重大变化：

​	-***扩大的地址容量***。IPv6将IP地址长度从32比特增加到128比特。这就确保全世界将不会用尽IP地址。除了单播与多播地址外，IPv6还引入了一种称为任播地址的新型地址，这种地址可以使数据报交付给一组主机中的任意一个。

​	-***简化高效的40字节首部***。40字节定长首部允许更快地处理IP数据报。

​	-***流标签与优先级***。IPv6有一个难以捉摸的流定义。RFC1752与RFC2460中描述道，该字段可用于“给属于特殊流的分组加上标签，这些特殊流是发送方要求进行特殊处理的流，如一种非默认服务质量或需要实时服务的流”。

IPv6定义的字段：

​	-***版本***。该4比特字段用于标识IP版本号。IPv6将该字段值设为6.

​	-***流量类型***。该8比特字段与我们在IPv4中看到的TOS字段的含义相似。

​	-***流标签***。该20比特字段用于标识一条数据报的流。

​	-***有效载荷长度***。该16比特值作为一个无符号整数，给出了IPv6数据报中跟在定长的40字节数据报首部后面的字节数量。

​	-***下一个首部***。该字段标识数据报中的内容(数据字段)需要交付给哪个协议(如TCP或UDP)。该字段使用与IPv4首部中协议字段相同的值。

​	-***跳限制***。转发数据报的每台路由器将对该字段的内容减一。如果跳限制计数到达0时，该数据报将被丢弃。

​	-***源地址和目的地址***。IPv6 128比特地址的各种格式在RFC 4291中进行了描述。

​	-***数据***。这是IPv6数据包的有效载荷部分。当数据报到达目的地时，该有效载荷就从IP数据报中移出，并交给在下一个手部字段中指定的协议处理。

​	-***分片/重新组装***。IPv6不允许在中间路由器上进行分片与重新组装。这种操作只能在源与目的地上执行。

​	-***首部检验和***。因为因特网层中的运输层(如TCP与UDP)和数据链路层(如以太网)协议执行了检验操作，IP设计者去掉了该功能。

​	-***选项***。选项字段不再是标准IP的首部的一部分。但他并没有消失，而是可能出现在IPv6首部中由“下一个人首部”指出的位置上。

由IPsec会话提供的服务包括：

​	***·密码技术约定***。这种机制允许两台通信的主机对加密算法和密钥达成一致。

​	***·IP数据报有效载荷的加密***。当发送主机从运输层接收到一个报文段时，IPsec加密该有效载荷。该有效载荷仅能由在接收主机中的IPsec解密。

​	***·数据完整性***。IPsec允许接收主机验证数据报的首部字段，保证被加密的有效载荷在其数据报从源到目的地的路由器中传输时没有被修改过。

​	***·初始鉴别***。当一台主机从某受信任的源(具有一个受信任的密钥)接收到一个IPsec数据报时，该主机确信在数据报中的源IP地址是该数据报的实际源。